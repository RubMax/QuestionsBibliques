<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saisie Questions & R√©ponses</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<!-- Header fixe -->
<div class="bg-light shadow-sm p-2 position-fixed top-0 start-0 w-100 d-flex justify-content-between align-items-center" style="z-index: 1000;">
  <h5 class="mb-0">Formulaire Q&R</h5>
  <a href="index.html" class="btn btn-secondary btn-sm">‚¨Ö Retour √† l'index</a>
</div>

<div class="container py-4">

  <!-- Choix du sujet √† modifier -->
  <div class="card p-3 mb-3 shadow-sm">
    <h6 class="mb-2">Modifier un sujet</h6>
    <div class="d-flex gap-2">
      <select id="sujetSelect" class="form-select"></select>
      <button class="btn btn-warning" id="loadSujetBtn">Charger</button>
    </div>
  </div>

  <form id="qaForm" class="card p-4 shadow-sm">
    <input type="hidden" name="id" id="recordId"> <!-- ID cach√© pour modification -->

    <div class="mb-3">
      <label class="form-label">Sujet</label>
      <input type="text" class="form-control" name="sujet" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Tags (s√©par√©s par des virgules)</label>
      <input type="text" class="form-control" name="tags" required>
    </div>

    <!-- Questions + R√©ponses -->
    <div class="mb-3">
      <label class="form-label">Question 01</label>
      <input type="text" class="form-control" name="question01">
      <textarea class="form-control mt-2" name="reponse01" rows="2" placeholder="R√©ponse 01"></textarea>
    </div>

    <div class="mb-3">
      <label class="form-label">Question 02</label>
      <input type="text" class="form-control" name="question02">
      <textarea class="form-control mt-2" name="reponse02" rows="2" placeholder="R√©ponse 02"></textarea>
    </div>

    <div class="mb-3">
      <label class="form-label">Question 03</label>
      <input type="text" class="form-control" name="question03">
      <textarea class="form-control mt-2" name="reponse03" rows="2" placeholder="R√©ponse 03"></textarea>
    </div>

    <div class="mb-3">
      <label class="form-label">Question 04</label>
      <input type="text" class="form-control" name="question04">
      <textarea class="form-control mt-2" name="reponse04" rows="2" placeholder="R√©ponse 04"></textarea>
    </div>

    <div class="mb-3">
      <label class="form-label">Question 05</label>
      <input type="text" class="form-control" name="question05">
      <textarea class="form-control mt-2" name="reponse05" rows="2" placeholder="R√©ponse 05"></textarea>
    </div>

    <button type="submit" class="btn btn-primary w-100">üíæ Enregistrer</button>
    <div id="message" class="mt-3"></div>
  </form>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw16vU3oy-YzhDFFAOmTzjdD4w4gdOLn3uS7C6mophbCZUkP93EYtqh96bXIrw8Hweq/exec"; 

// Charger la liste des sujets au d√©marrage
async function loadSujetsList() {
  try {
    const res = await fetch(SCRIPT_URL + "?action=list");
    const sujets = await res.json();
    const select = document.getElementById("sujetSelect");
    select.innerHTML = "<option value=''>-- Choisir un sujet --</option>";
    sujets.forEach(s => {
      select.innerHTML += `<option value="${s.id}">${s.sujet}</option>`;
    });
  } catch (err) {
    console.error("Erreur chargement sujets:", err);
  }
}

// Charger un sujet dans le formulaire
document.getElementById("loadSujetBtn").addEventListener("click", async () => {
  const id = document.getElementById("sujetSelect").value;
  if (!id) return alert("S√©lectionnez un sujet !");
  try {
    const res = await fetch(SCRIPT_URL + "?action=get&id=" + id);
    const data = await res.json();
    // Remplir le formulaire
    for (let key in data) {
      if (document.querySelector(`[name=${key}]`)) {
        document.querySelector(`[name=${key}]`).value = data[key];
      }
    }
  } catch (err) {
    alert("Erreur lors du chargement du sujet.");
  }
});

// Enregistrement (ajout ou modification)
document.getElementById("qaForm").addEventListener("submit", async function(e){
  e.preventDefault();
  
  const formData = new FormData(this);
  let data = {};
  formData.forEach((value, key) => data[key] = value);

  try {
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify(data)
    });
    const result = await res.json();

    if(result.status === "success") {
      document.getElementById("message").innerHTML = `<div class="alert alert-success">‚úÖ Sauvegarde r√©ussie</div>`;
      loadSujetsList(); // recharger la liste
    } else {
      document.getElementById("message").innerHTML = `<div class="alert alert-danger">‚ùå Erreur: ${result.message}</div>`;
    }
  } catch (err) {
    document.getElementById("message").innerHTML = `<div class="alert alert-danger">‚ö† Erreur r√©seau: ${err}</div>`;
  }
});

// Charger la liste des sujets au d√©marrage
loadSujetsList();
</script>

</body>
</html>
